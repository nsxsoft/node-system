{"version":3,"file":"portal-vue.js","sources":["../src/utils.js","../src/components/wormhole.js","../src/components/portal-target.js","../src/components/portal.js","../src/index.js"],"sourcesContent":["export function extractAttributes (el) {\n  const map = el.hasAttributes() ? el.attributes : []\n  const attrs = {}\n  for (let i = 0; i < map.length; i++) {\n    const attr = map[i]\n    if (attr.value) {\n      attrs[attr.name] = attr.value === '' ? true : attr.value\n    }\n  }\n  return attrs\n}\n\nexport function freeze (item) {\n  if (Array.isArray(item) || typeof item === 'object') {\n    return Object.freeze(item)\n  }\n  return item\n}\n","import Vue from 'vue'\nimport { freeze } from '../utils'\nconst transports = {}\n\nexport { transports }\n\nexport class Wormhole {\n  constructor (transports) {\n    this.transports = transports\n  }\n\n  open (transport) {\n    const { to, from, passengers } = transport\n    if (!to || !from || !passengers) return\n\n    transport.passengers = freeze(passengers)\n    const keys = Object.keys(this.transports)\n    if (keys.indexOf(to) !== -1) {\n      this.transports[to] = transport\n    } else {\n      Vue.set(this.transports, to, transport)\n    }\n  }\n\n  close (transport, force = false) {\n    const { to, from } = transport\n    if (!to || !from) return\n    if (this.transports[to] && (force || this.transports[to].from === from)) {\n      this.transports[to] = undefined\n    }\n  }\n\n  hasTarget (to) {\n    return this.transports.hasOwnProperty(to)\n  }\n\n  hasContentFor (to) {\n    /* eslint no-unneeded-ternary: 0 */\n    return this.transports[to] && this.transports[to].passengers != null\n      ? true\n      : false\n  }\n\n  getSourceFor (to) {\n    return this.transports[to] && this.transports[to].from\n  }\n\n  getContentFor (to) {\n    const transport = this.transports[to]\n    return transport ? transport.passengers : undefined\n  }\n}\nconst wormhole = new Wormhole(transports)\nexport default wormhole\n","\nimport { transports } from './wormhole'\n\nexport default {\n  abstract: true,\n  name: 'portalTarget',\n  props: {\n    attributes: { type: Object },\n    name: { type: String, required: true },\n    slim: { type: Boolean, default: false },\n    tag: { type: String, default: 'div' },\n  },\n  data () {\n    return {\n      transports,\n    }\n  },\n\n  mounted () {\n    if (!this.transports[this.name]) {\n      this.$set(this.transports, this.name, undefined)\n    }\n\n    this.unwatch = this.$watch(function () { return this.transports[this.name] }, this.emitChange)\n\n    this.updateAttributes()\n  },\n  updated () {\n    this.updateAttributes()\n  },\n  beforeDestroy () {\n    this.unwatch()\n    this.$el.innerHTML = ''\n  },\n\n  methods: {\n    updateAttributes () {\n      if (this.attributes) {\n        const attrs = this.attributes\n        const el = this.$el\n\n        // special treatment for class\n        if (attrs.class) {\n          attrs.class.trim().split(' ').forEach((klass) => {\n            el.classList.add(klass)\n          })\n          delete attrs.class\n        }\n\n        const keys = Object.keys(attrs)\n\n        for (let i = 0; i < keys.length; i++) {\n          el.setAttribute(keys[i], attrs[keys[i]])\n        }\n      }\n    },\n    emitChange (newTransport, oldTransport) {\n      this.$emit('change',\n        { ...newTransport },\n        { ...oldTransport }\n      )\n    },\n  },\n  computed: {\n    passengers () {\n      return (this.transports[this.name] && this.transports[this.name].passengers) || []\n    },\n    children () {\n      return this.passengers.length !== 0 ? this.passengers : (this.$slots.default || [])\n    },\n    renderSlim () {\n      const children = this.children\n      return children.length === 1 && !this.attributes && this.slim\n    },\n  },\n\n  render (h) {\n    const children = this.children\n    const Tag = this.tag\n    if (this.renderSlim) {\n      return children[0]\n    } else {\n      return (<Tag class={'vue-portal-target'}>{children}</Tag>)\n    }\n  },\n}\n","\nimport Vue from 'vue'\nimport wormhole from './wormhole'\nimport Target from './portal-target'\nimport { extractAttributes } from '../utils'\n\nconst inBrowser = (typeof window !== 'undefined')\n\nlet pid = 1\n\nexport default {\n  abstract: true,\n  name: 'portal',\n  props: {\n    /* global HTMLElement */\n    disabled: { type: Boolean, default: false },\n    name: { type: String, default: () => String(pid++) },\n    slim: { type: Boolean, default: false },\n    tag: { type: [String], default: 'DIV' },\n    targetEl: { type: inBrowser ? [String, HTMLElement] : String },\n    to: { type: String, default: () => String(Math.round(Math.random() * 10000000)) },\n  },\n\n  mounted () {\n    if (this.targetEl) {\n      this.mountToTarget()\n    }\n    if (!this.disabled) {\n      this.sendUpdate()\n    }\n  },\n\n  updated () {\n    if (this.disabled) {\n      this.clear()\n    } else {\n      this.sendUpdate()\n    }\n  },\n\n  beforeDestroy () {\n    this.clear()\n    if (this.mountedComp) {\n      this.mountedComp.$destroy()\n    }\n  },\n\n  watch: {\n    to (newValue, oldValue) {\n      oldValue && this.clear(oldValue)\n      this.sendUpdate()\n    },\n    targetEl (newValue, oldValue) {\n      this.mountToTarget()\n    },\n  },\n\n  methods: {\n\n    sendUpdate () {\n      if (this.to) {\n        if (this.$slots.default) {\n          wormhole.open({\n            from: this.name,\n            to: this.to,\n            passengers: [...this.$slots.default],\n          })\n        }\n      } else if (!this.to && !this.targetEl) {\n        console.warn('[vue-portal]: You have to define a target via the `to` prop.')\n      }\n    },\n\n    clear (target) {\n      wormhole.close({\n        from: this.name,\n        to: target || this.to,\n      })\n    },\n\n    mountToTarget () {\n      let el\n      const target = this.targetEl\n\n      if (typeof target === 'string') {\n        el = document.querySelector(this.targetEl)\n      } else if (target instanceof HTMLElement) {\n        el = target\n      } else {\n        console.warn('[vue-portal]: value of targetEl must be of type String or HTMLElement')\n        return\n      }\n\n      const attributes = extractAttributes(el)\n\n      if (el) {\n        const target = new Vue({\n          ...Target,\n          parent: this,\n          propsData: {\n            name: this.to,\n            tag: el.tagName,\n            attributes,\n          },\n        })\n        target.$mount(el)\n        this.mountedComp = target\n      } else {\n        console.warn('[vue-portal]: The specified targetEl ' + this.targetEl + ' was not found')\n      }\n    },\n  },\n\n  render (h) {\n    const children = this.$slots.default || []\n    const Tag = this.tag\n    if (children.length && this.disabled) {\n      return children.length <= 1 && this.slim\n        ? children[0]\n        : (<Tag>{children}</Tag>)\n    } else {\n      return (<Tag class={'v-portal'} style={'display: none'} key={'v-portal-placeholder'}/>)\n      // h(this.tag, { class: { 'v-portal': true }, style: { display: 'none' }, key: 'v-portal-placeholder' })\n    }\n  },\n}\n","import Portal from './components/portal.js'\nimport PortalTarget from './components/portal-target.js'\nimport Wormhole from './components/wormhole.js'\n\nfunction install (Vue, opts = {}) {\n  Vue.component(opts.portalName || 'portal', Portal)\n  Vue.component(opts.portalTargetName || 'portal-target', PortalTarget)\n}\nif (typeof window !== 'undefined' && window.Vue) {\n  window.Vue.use({ install: install })\n}\n\nexport default {\n  install,\n  Portal,\n  PortalTarget,\n  Wormhole,\n}\n"],"names":["extractAttributes","el","map","hasAttributes","attributes","attrs","i","length","attr","value","name","freeze","item","Array","isArray","Object","transports","Wormhole","transport","to","from","passengers","keys","indexOf","set","force","undefined","hasOwnProperty","wormhole","type","String","required","Boolean","default","$set","unwatch","$watch","emitChange","updateAttributes","$el","innerHTML","class","trim","split","forEach","klass","classList","add","setAttribute","newTransport","oldTransport","$emit","$slots","children","slim","h","Tag","tag","renderSlim","inBrowser","window","pid","HTMLElement","Math","round","random","targetEl","mountToTarget","disabled","sendUpdate","clear","mountedComp","$destroy","newValue","oldValue","open","warn","target","close","document","querySelector","Vue","Target","tagName","$mount","install","opts","component","portalName","Portal","portalTargetName","PortalTarget","use"],"mappings":"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"}